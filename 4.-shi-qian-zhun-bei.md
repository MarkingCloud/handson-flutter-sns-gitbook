# 4. 事前準備

## 1. Gitpod でコードを開く

Gitpod を開いて作業環境を立ち上げましょう。

{% hint style="success" %}
### work

[**Gitpodでリポジトリを開く（クリックしてください）**](https://gitpod.io/#https://github.com/MarkingCloud/handson-flutter-sns/tree/part2-firebase)****
{% endhint %}

{% hint style="info" %}
テーマをダークモードに変更したい場合は次の手順を実行してください。

* 歯車マーク > Color Theme > 好きなテーマを選択 (Dark+ default dark がオススメ)
{% endhint %}

![](https://gblobscdn.gitbook.com/assets%2F-MkUYx1nH-LtZrLYKsQ9%2F-MkcGHXiIqQver\_0qpX4%2F-MkcH6Y5qe1eRe5yTPHB%2Fdark.png?alt=media\&token=48e8a4ae-57fd-45ed-b719-a27f978ed475)



## 2. ディレクトリ構成

ディレクトリはこのような構成になっています。\
主要なファイルは以下の通りで、コードはすべて `lib/`の中に記述していきます。

```bash
/workspace/handson-flutter-sns
|--.dart_tool
|--android
|--ios
|
|--"lib        <----------------- コードの記述場所 "
|  |--abstract
|  |--postmodal
|  |--timeline
|  |--main.dart
|
|--test
|--"web        <----------------- webのビルド結果が入る "
|--.git
|--.gitignore
|--.gitpod.Dockerfile
|--.gitpod.yml
|--.metadata
|--.packages
|--.firebaserc
|--analysis_options.yaml
|--pubspec.lock
|--pubspec.yaml
|--README.md
|--"firebase.json    <----------- firebaseの基本設定 "
|--"firestore.rules  <----------- firestoreのルール "
```

## 3. Firebase プロジェクトを作成する

Firebase のプロジェクトを作成しましょう。次の操作を行ってください。

{% hint style="success" %}
### work

* [**Firebase コンソール**](https://console.firebase.google.com)を開く
* 「プロジェクトを追加」を選択。
* 好きなプロジェクト名を入力して「続行」を選択。
* **Google アナリティクスは無効**にして「プロジェクトを作成」を選択。
{% endhint %}

{% embed url="https://scribehow.com/shared/Firebase__k-dMJVzpS7q3sQlRiO8k-g" %}

## 4. プロジェクトとターミナルを紐づける

作成したプロジェクトを Gitpod に紐づけます。コンソールから次の操作を行ってください。

{% hint style="success" %}
### work

* 次のコマンドを実行する。

```
firebase login --no-localhost --reauth
```

* 出力された URL をクリックする。
* Firebase にログインしているアカウントと同じアカウントを選択。
* 権限を確認して許可をクリックする。
* 出力された認証コードをコンソールに貼り付けてエンターを押下する。
* 次のコマンドを実行し、先ほど作成したプロジェクトのプロジェクトIDを選択する。

```
firebase use --add
```

* 次のコマンドを実行し、正しいプロジェクトに (current) とついていることを確認する。

```
firebase projects:list
```
{% endhint %}

{% embed url="https://scribehow.com/shared/__2JrWAC0cTVCMsOBKLr2TTg" %}

## 5. アプリを作成してFlutterプロジェクトに登録する

Flutter for WebでFirebaseを利用するためには、\
`web/index.html`設定を記述してCDN経由でFirebaseSDKを取得する必要があります。\
次の操作を行ってください。

{% hint style="success" %}
### work

* コンソールトップ画面の web マーク (\</>) を選択
* 任意のアプリのニックネームを設定
* 「アプリを登録」を選択（チェックボックスは空のまま）
* firebaseConfigの内容をコピーする
* 「コンソールに進む」を選択
{% endhint %}

![](<.gitbook/assets/image (6).png>)

{% hint style="success" %}
### work

* `web/index.html`の`frebaseConfig`をコピーしたもので書き換える。

{% code title="web/index.html " %}
```markup
  <!-- Add Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
  <script>
+   const firebaseConfig = {
+     apiKey: "xxxxxxxxxxxxxxxx",
+     authDomain: "xxxxxxxx.firebaseapp.com",
+     projectId: "xxxxxxxx",
+     storageBucket: "xxxxxxxx.appspot.com",
+     messagingSenderId: "xxxxxxxx",
+     appId: "xxxxxxxxxxxxxxxx"
+   };
    firebase.initializeApp(firebaseConfig);
  </script>
```
{% endcode %}
{% endhint %}

{% embed url="https://scribehow.com/shared/Flutter__Wvx1CbfuQGSPY80PLQbs7Q" %}

これで事前準備は完了です。

## 6. コードを実行してみる

動作確認コードを実行してブラウザから開てみましょう。次の操作を行ってください。

{% hint style="success" %}
#### work

* コマンドを実行する

```bash
flutter run -d web-server --web-port=8080 --web-renderer html
```

* 出力されたURLを**Ctrl+クリック**でブラウザから開く
{% endhint %}

{% hint style="warning" %}
時間が経ってもロードが終わらない場合、**広告ブロック系の拡張機能を止めて**みてください。\
Adblockが原因で正常に動作しないケースを確認しています。
{% endhint %}

次の様な画面が表示されれば成功です。まだ何も機能を持っていない状態です。

![](<.gitbook/assets/image (7).png>)
